var JSKit=function(){if(!_)throw new Error("JSKit: lodash or underscore is required");if(!$)throw new Error("JSKit: jQuery or equivalent is required");return{createApplication:function(){return JSKit.Application.create()}}}();JSKit.Dispatcher=function(){function n(n,e){return n.__events__[e]=n.__events__[e]||[],n.__events__[e]}function e(n,e){return n=n||null,{context:n,handler:e}}function t(n,e,t){t=t||"push",r(i(n,"handler"),e.handler)||n[t](e)}var r=_.contains,i=_.pluck;return{create:function(){return{__events__:{},on:function(r,i,o){var a=e(o,i),c=n(this,r);t(c,a)},before:function(r,i,o){var a=e(o,i),c=n(this,r);t(c,a,"unshift")},off:function(n,e){var t=this.__events__[n];this.__events__[n]=e?_.reject(t,function(n){return n.handler!==e}):[]},trigger:function(n){var e=this.__events__[n]||[],t=_.rest(arguments);_.each(e,function(n){var e=n.handler,r=n.context;e.apply(r,t)})}}}}}(),JSKit.Controller=function(){function n(n){return n=n||"",n.replace(/([A-Z])/g," $1").replace(/^\s?/,"").replace(/-|\s/g,"_").toLowerCase()}function e(n){h(n.actions,function(e){h(t(e),function(e){r(n,e),n.dispatcher.on(i(n,e.name),n[e.method],n)},n)},n)}function t(n){return mappedActions=m(n)?d(n,function(n,e){return{name:e,method:n}}):[{name:n,method:n}],mappedActions}function r(n,e){if(!p(n[e.method]))throw new Error(n.name+' action "'+e.name+":"+e.method+'" method is undefined')}function i(n,e){return l([n.namespace,n.channel,n.controllerEventName,e]).join(n.eventSeparator)}function o(n,e){n.elements[e]&&h(n.elements[e],function(e,t){n["$"+t]=$(e)},n)}function a(n,e){n.events[e]&&h(n.events[e],function(e,t){h(e,function(e,r){var i=n[e],o=n["$"+t];o.on(r,i)},n)},n)}function c(n){h(n.elements,function(e,t){n.dispatcher.before(i(n,t),function(){o(n,t)},n)},n)}function u(n){h(n.events,function(e,t){n.dispatcher.on(i(n,t),function(){a(n,t)},n)},n)}{var s=_.bindAll,l=_.compact,f=_.defaults,h=_.each,p=(_.first,_.flatten,_.functions,_.isFunction),m=_.isObject,d=(_.keys,_.map);_.pairs,_.uniq,_.values}return{create:function(t){if(t=t||{},!t.name)throw new Error("Controller.create(name): name is undefined");var r=f(t,{actions:[],namespace:"",channel:"controller",controllerEventName:n(t.name),dispatcher:JSKit.Dispatcher.create(),elements:{},events:{},eventSeparator:":",all:function(){},initialize:function(){}});return s(r),r.actions.unshift("all"),c(r),u(r),e(r),r.initialize(),r}}}(),JSKit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var e=t(n.split(/_|-|\s/g),function(n,e){return e>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=e}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var e=_.extend,t=_.map;return{create:function(){var t=JSKit.Dispatcher.create();return{Controllers:{},Dispatcher:t,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=n(r)+"Controller",a=this[o]={create:function(n){return n=n||{name:r},JSKit.Controller.create(e({},i,n))}};return this.Controllers[r]=a.create({dispatcher:t}),this.Controllers[r]}}}}}();