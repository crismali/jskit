var JSKit=function(){if(!_)throw new Error("JSKit: lodash or underscore is required");return{createApplication:function(){return JSKit.Application.create()}}}();JSKit.Dispatcher=function(){function n(n,e){return n.__events__[e]=n.__events__[e]||[]}function e(n,e){return n=n||null,{context:n,handler:e}}function t(n,e,t){t=t||"push",r(i(n,"handler"),e.handler)||n[t](e)}var r=_.contains,i=_.pluck;return{create:function(){return{__events__:{},on:function(r,i,o){var a=e(o,i),c=n(this,r);t(c,a)},before:function(r,i,o){var a=e(o,i),c=n(this,r);t(c,a,"unshift")},off:function(n,e){var t=this.__events__[n];this.__events__[n]=e?_.reject(t,function(n){return n.handler!==e}):[]},trigger:function(n){var e=this.__events__[n]||[],t=_.rest(arguments);_.each(e,function(n){var e=n.handler,r=n.context;e.apply(r,t)})}}}}}(),JSKit.Controller=function(){function n(n){return n=n||"",n.replace(/([A-Z])/g," $1").replace(/^\s?/,"").replace(/-|\s/g,"_").toLowerCase()}function e(n){h(n.actions,function(e){var o=t(e);r(n,o),n.dispatcher.on(i(n,o.name),n[o.method],n)},n)}function t(n){var e=m(n),t=e?p(C(n)):n,r=e?p(d(n)):n;return{name:r,method:t}}function r(n,e){if(!v(n[e.method]))throw new Error(n.name+' action "'+e.name+":"+e.method+'" method is undefined')}function i(n,e){return l([n.namespace,n.channel,n.controllerEventName,e]).join(n.eventSeparator)}function o(n,e){n.elements[e]&&h(n.elements[e],function(e,t){n["$"+t]=$(e)},n)}function a(n,e){n.events[e]&&h(n.events[e],function(e,t){var r=p(d(e)),i=n[p(C(e))],o=n["$"+t];o.on(r,i)},n)}function c(n){h(n.elements,function(e,t){n.dispatcher.before(i(n,t),function(){o(n,t)},n)},n)}function u(n){h(n.events,function(e,t){n.dispatcher.on(i(n,t),function(){a(n,t)},n)},n)}var s=_.bindAll,l=_.compact,f=_.defaults,h=_.each,p=_.first,v=(_.functions,_.isFunction),m=_.isObject,d=_.keys,C=(_.uniq,_.values);return{create:function(t){if(t=t||{},!t.name)throw new Error("Controller.create(name): name is undefined");var r=f(t,{actions:[],channel:"controller",controllerEventName:n(t.name),dispatcher:JSKit.Dispatcher.create(),elements:{},events:{},eventSeparator:":",all:function(){},initialize:function(){}});return s(r),r.actions.unshift("all"),c(r),u(r),e(r),r.initialize(),r}}}(),JSKit.Application=function(){function n(n){if(n=n||"",n.match(/_|-|\s/)){var e=t(n.split(/_|-|\s/g),function(n,e){return e>0?n.charAt(0).toUpperCase()+n.slice(1):n.toLowerCase()}).join("");n=e}else n=n.toString();return n.charAt(0).toUpperCase()+n.slice(1)}var e=_.extend,t=_.map;return{create:function(){var t=JSKit.Dispatcher.create();return{Controllers:{},Dispatcher:t,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o={create:function(n){return n=n||{name:r},JSKit.Controller.create(e({},i,n))}};return this[n(r)+"Controller"]=o,this.Controllers[r]=o.create({dispatcher:t})}}}}}();