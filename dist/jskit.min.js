var JSKit=function(){if(!_)throw new Error("JSKit: lodash or underscore is required");if(!$)throw new Error("JSKit: jQuery or equivalent is required");return{createApplication:function(){return JSKit.Application.create()}}}();JSKit.Dispatcher=function(){function e(e,n){return e.__events__[n]=e.__events__[n]||[],e.__events__[n]}function n(e,n){return e=e||null,{context:e,handler:n}}function t(e,n,t){t=t||"push",r(i(e,"handler"),n.handler)||e[t](n)}var r=_.contains,i=_.pluck;return{create:function(){return{__events__:{},on:function(r,i,o){var a=n(o,i),c=e(this,r);t(c,a)},before:function(r,i,o){var a=n(o,i),c=e(this,r);t(c,a,"unshift")},off:function(e,n){var t=this.__events__[e];this.__events__[e]=n?_.reject(t,function(e){return e.handler!==n}):[]},trigger:function(e){var n=this.__events__[e]||[],t=_.rest(arguments);_.each(n,function(e){var n=e.handler,r=e.context;n.apply(r,t)})}}}}}(),JSKit.Controller=function(){function e(e){return e=e||"",e.replace(/([A-Z])/g," $1").replace(/^\s?/,"").replace(/-|\s/g,"_").toLowerCase()}function n(e){h(e.actions,function(n){var o=t(n);r(e,o),e.dispatcher.on(i(e,o.name),e[o.method],e)},e)}function t(e){var n=m(e),t=n?p(C(e)):e,r=n?p(d(e)):e;return{name:r,method:t}}function r(e,n){if(!v(e[n.method]))throw new Error(e.name+' action "'+n.name+":"+n.method+'" method is undefined')}function i(e,n){return l([e.namespace,e.channel,e.controllerEventName,n]).join(e.eventSeparator)}function o(e,n){e.elements[n]&&h(e.elements[n],function(n,t){e["$"+t]=$(n)},e)}function a(e,n){e.events[n]&&h(e.events[n],function(n,t){var r=p(d(n)),i=e[p(C(n))],o=e["$"+t];o.on(r,i)},e)}function c(e){h(e.elements,function(n,t){e.dispatcher.before(i(e,t),function(){o(e,t)},e)},e)}function u(e){h(e.events,function(n,t){e.dispatcher.on(i(e,t),function(){a(e,t)},e)},e)}var s=_.bindAll,l=_.compact,f=_.defaults,h=_.each,p=_.first,v=(_.functions,_.isFunction),m=_.isObject,d=_.keys,C=(_.uniq,_.values);return{create:function(t){if(t=t||{},!t.name)throw new Error("Controller.create(name): name is undefined");var r=f(t,{actions:[],namespace:"",channel:"controller",controllerEventName:e(t.name),dispatcher:JSKit.Dispatcher.create(),elements:{},events:{},eventSeparator:":",all:function(){},initialize:function(){}});return s(r),r.actions.unshift("all"),c(r),u(r),n(r),r.initialize(),r}}}(),JSKit.Application=function(){function e(e){if(e=e||"",e.match(/_|-|\s/)){var n=t(e.split(/_|-|\s/g),function(e,n){return n>0?e.charAt(0).toUpperCase()+e.slice(1):e.toLowerCase()}).join("");e=n}else e=e.toString();return e.charAt(0).toUpperCase()+e.slice(1)}var n=_.extend,t=_.map;return{create:function(){var t=JSKit.Dispatcher.create();return{Controllers:{},Dispatcher:t,createController:function(r,i){if(i=i||{},!r)throw new Error("Application.createController(name, attrs): name is undefined");i.name=r;var o=e(r)+"Controller",a=this[o]={create:function(e){return e=e||{name:r},JSKit.Controller.create(n({},i,e))}};return this.Controllers[r]=a.create({dispatcher:t}),this.Controllers[r]}}}}}();